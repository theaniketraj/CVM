name: Automate Versioning

on:
    push:
        branches:
            - main

jobs:
    versioning:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout Repository
              uses: actions/checkout@v4
              with: 
                  persist-credentials: true

            - name: Set up Java & Gradle
              uses: actions/setup-java@v3
              with:
                    distribution: 'temurin'
                    java-version: '17'

            - name: Increment Version
              run: ./gradlew incrementVersion
              env: 
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            - name: Commit & Push Version Update
              run: |
                    git config --global user.name "github-actions[bot]"
                    git config --global user.email "github-actions[bot]@users.noreply.github.com"
                    git add version.properties
                    git commit -m "Auto-increment version"
                    git push
                    env: 
                        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            - name: Create Git Tag
              run: |
                    VERSION=$(grep "version" version.properties | cut -d'=' -f2)
                    git tag -a "v$VERSION"
                    git push origin "v$VERSION"
